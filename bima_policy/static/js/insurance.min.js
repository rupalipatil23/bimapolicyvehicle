function setAgentComm() {
    var t = $("#od").val(),
        e = $("#tp").val(),
        a = $("#ag_reward_pct").val(),
        n = 0;
    "" == !t && $.isNumeric(t) && "" == !e && $.isNumeric(e) && "" == !a && (n = "OD" == $("select[name='ag_reward_on']").val() ? ((a * t) / 100).toFixed(0) : ((a * (parseInt(t) + parseInt(e))) / 100).toFixed(0)),
        $("input[name='ag_commision']").val(n),
        $("input[name='ag_commision']").next("p").html(n);
}
$(document).ready(function () {
    var t = $(".ajax-progressBar"),
        e = $(".ajax-progressBar .postProgress");
    $("#frminsurance").ajaxForm({
        beforeSend: function () {
            var a = $("#frminsurance");
            if (!a.parsley().isValid()) return !1;
            $(a.find("button[type='submit']")).each(function () {
                btnBusy($(this));
            }),
                window.scrollTo(0, 0),
                t.fadeIn(),
                $(e).width("0%").html("0%");
        },
        uploadProgress: function (t, a, n, o) {
            var i = o - 1 + "%";
            $(e).width(i).html(i);
        },
        url: "Submit",
        data: { request: "InsuranceForm" },
        success: function (t, a, n, o) {
            try {
                percentVal = "100%";
                var i = $.parseJSON(t);
                toastr[i.status](i.response),
                    "success" == i.status &&
                        ($(e).width(percentVal).addClass("bg-success").html(percentVal),
                        "" != i.url &&
                            setInterval(function () {
                                window.location.href = i.url;
                            }, 2e3));
            } catch (t) {
                systemError();
            }
            $(o.find("button[type='submit']")).each(function () {
                btnFree($(this));
            });
        },
        complete: function (e) {
            t.fadeOut();
        },
    }),
        $("#od,#tp").change(function () {
            var t = $("#od").val(),
                e = $("#tp").val();
            if (($("#pt").val("Comp"), "" == !t && $.isNumeric(t) && "" == !e && $.isNumeric(e))) {
                var a = parseInt(t) + parseInt(e);
                $("#net").val(a.toFixed(0)),
                    "" == !$("#gst").val() && $.isNumeric($("#gst").val()) && $("#totalnet").val((parseInt($("#gst").val()) + a).toFixed(0)),
                    "" != e && $.isNumeric(e) && 0 != e ? ("" != t && $.isNumeric(t) && 0 != t) || $("#pt").val("TP") : $("#pt").val("SAOD"),
                    setAgentComm(),
                    setSelfComm();
            }
        }),
        $("#gst").change(function () {
            var t = $("#od").val(),
                e = $("#tp").val(),
                a = $(this).val();
            if ("" == !t && $.isNumeric(t) && "" == !e && $.isNumeric(e) && "" == !a && $.isNumeric(a)) {
                var n = parseInt(t) + parseInt(e) + parseInt(a);
                $("#totalnet").val(n.toFixed(0));
            }
            setAgentComm(), setSelfComm();
        }),
        $("#document").on("change", function () {
            myfile = $(this).val();
            var t = myfile.split(".").pop();
            "pdf" == t || "PDF" == t || "" == myfile || (alert("Accept Only PDF File"), $(this).val(""));
        }),
        $("#previous_policy").on("change", function () {
            myfile = $(this).val();
            var t = myfile.split(".").pop();
            "pdf" == t || "PDF" == t || "" == myfile || "jpg" == t || "JPG" == t || "jpeg" == t || "JPEG" == t || "png" == t || "PNG" == t || (alert("Accept Only PDF or Image"), $(this).val(""));
        }),
        $("#vehicle_rc").on("change", function () {
            myfile = $(this).val();
            var t = myfile.split(".").pop();
            "pdf" == t || "PDF" == t || "" == myfile || "jpg" == t || "JPG" == t || "jpeg" == t || "JPEG" == t || "png" == t || "PNG" == t || (alert("Accept Only PDF or Image"), $(this).val(""));
        }),
        $("#rc_delete").on("click", function () {
            confirm("Do You want to delete Vehicle RC?") && ($(this).prev("a").remove(), $("input[name='" + $(this).attr("id") + "']").attr("checked", !0), $(this).remove());
        }),
        $("#prepolicy_delete").on("click", function () {
            confirm("Do You want to delete Previous Policy?") && ($(this).prev("a").remove(), $("input[name='" + $(this).attr("id") + "']").attr("checked", !0), $(this).remove());
        }),
        $("#filterlist").click(function () {
            generateTable();
        }),
        $("#btnreset").click(function () {
            $("#frminslist")[0].reset(), setDate("this_month", "#frmDate", "#toDate"), generateTable();
			$('#agent').val('').trigger('change');$('#service_provider').val('').trigger('change');$('#vehicle_category').val('').trigger('change');
		}),
        $("#download_inslist").click(function () {
            var t = $("#frmDate").val() ? $("#frmDate").val() : "",
                e = $("#toDate").val() ? $("#toDate").val() : "",
				s = $("#service_provider").val() ? $("#service_provider").val() : "",
				c = $("#vehicle_category").val() ? $("#vehicle_category").val() : "";
				
            generateTable(), $.redirectPost("download.php", { download: "download_inslist", frmDate: t, toDate: e, sp:s,vc:c,agent: $("#agent").val() });
        });
}),
    $(function () {
        $('div[data-toggle="issue_flatpickr"]').flatpickr({ maxDate: new Date().fp_incr(0), defaultDate: "today", onChange: function (a, e) { /*t.set("minDate", e), t.setDate(e);*/ }});
        var t = $('div[data-toggle="risk_flatpickr"]').flatpickr({ maxDate: new Date().fp_incr(365), onChange: function (t, e) {} });
    }),
    $(document).on("change", "select[name='vehicle_makeby']", function () {
        var t = $(this);
        $.get("../Submit", { request: "getVehicleModel", makeby: t.val() }, function (t) {
            $("select[name='vehicle_model']").html(t);
        });
    }),
    $(document).on("change", "input[type='radio'][name='ag_calculation']", function () {
        "Mannual" == $(this).val() ? ($(".ag-toggle-mannual").show(), $(".ag-toggle-auto").hide()) : ($(".ag-toggle-mannual").hide(), $(".ag-toggle-auto").show());
    }),
    $(document).on("change", "select[name='ag_reward_on'],#ag_reward_pct", function () {
        setAgentComm();
    }),
    $(document).on("change", "input[type='radio'][name='sf_calculation']", function () {
        "Mannual" == $(this).val() ? ($(".sf-toggle-mannual").show(), $(".sf-toggle-auto").hide()) : ($(".sf-toggle-mannual").hide(), $(".sf-toggle-auto").show());
    }),
    $(document).on("click", ".btn-payout-close", function () {
        $.get("../Submit", { request: "getEmptyPayout" }, function (t) {
            $("#payoutSection").html(t);
        });
    }),
    $(document).on("click", "#payoutapply", function () {
        var t = $("#frminsurance");
        if (($(t).parsley().validate("payout"), !t.parsley().isValid("payout"))) return !1;
        $("#mdlpayout").modal("show"),
            $("#mdlpayout .modal-body").html("<div class='text-center'><span class='spinner-border spinner-border-sm' role='status' aria-hidden='true'></span> Loading...</div>"),
            $.ajax({
                type: "POST",
                url: "../Submit",
                data: $(t).serialize() + "&request=getPayouts",
                success: function (t) {
                    try {
                        (obj = $.parseJSON(t)), $("#mdlpayout .modal-body").html(obj.response), obj.status ? $("button[name='applypayout']").removeAttr("disabled") : $("button[name='applypayout']").attr("disabled", "disabled");
                    } catch (t) {
                        systemError();
                    }
                },
            });
    }),
    $(document).on("click", "button[name='applypayout']", function () {
        var t = $("input[name='payout']:checked").val();
        $.get("../Submit", { request: "getPayout", id: t }, function (t) {
            $("#payoutSection").html(t), setAgentComm(), setSelfComm();
        }),
            $("#mdlpayout").modal("hide");
    });
